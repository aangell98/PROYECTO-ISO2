<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Realizar Pedido</title>
    <link rel="stylesheet" href="/css/styles.css">
</head>

<body>
    <div class="container">
        <header>
            <h1>Realizar Pedido</h1>
        </header>
        <main>
            <section id="restauranteInfo">
                <h2>Información del Restaurante</h2>
                <p>Nombre: <span th:text="${restaurante.nombre}"></span></p>
                <p>Dirección: <span th:text="${restaurante.direccion}"></span></p>
            </section>
            <section id="menus">
                <h2>Cartas de Menú Disponibles</h2>
                <ul>
                    <li th:each="cartaMenu : ${restaurante.cartasMenu}">
                        <h3 th:text="${cartaMenu.nombre}"></h3>
                        <p th:text="${cartaMenu.descripcion}"></p>
                        <p><strong>Precio Total:</strong> <span th:text="${cartaMenu.precioTotal} + ' €'"></span></p>

                        <!-- Lista de items del menú -->
                        <ul>
                            <li th:each="item : ${cartaMenu.items}">
                                <p><strong>Nombre:</strong> <span th:text="${item.nombre}"></span></p>
                                <p><strong>Descripción:</strong> <span th:text="${item.descripcion}"></span></p>
                                <p><strong>Precio:</strong> <span th:text="${item.precio} + ' €'"></span></p>
                            </li>
                        </ul>

                        <button th:onclick="'agregarAlCarrito(' + ${cartaMenu.id} + ')'">Añadir al Carrito</button>



                        <hr> <!-- Separador entre menús -->
                    </li>
                </ul>
            </section>
            <section id="carrito">
                <!-- Carrito de Compras -->
                <div class="carrito-container">
                    <h3>Carrito</h3>
                    <ul id="carritoItems"></ul> <!-- Aquí se mostrarán los ítems añadidos al carrito -->
                    <p>Total: <span id="precioTotal">0</span> €</p>
                    <!-- Botón para realizar el pedido -->
                    <button onclick="realizarPedido()">Confirmar Pedido</button>
                </div>
            </section>

            <section id="contact">
                <h2>Contacto</h2>
                <p>Información de contacto y formulario.</p>
            </section>
        </main>
        <footer>
            <p>&copy; 2024 Delivery. Todos los derechos reservados. Work In Progress</p>
        </footer>
    </div>
    <script>
        function agregarAlCarrito(cartaMenuId) {
            fetch('/agregar_al_carrito', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ id: cartaMenuId }) // Enviar ID del menú completo como JSON
            })
                .then(response => response.json())
                .then(carrito => {
                    // Actualiza el contenido del carrito en la vista
                    let carritoItems = document.getElementById('carritoItems');
                    carritoItems.innerHTML = ''; // Limpia el carrito
                    carrito.items.forEach(item => {
                        carritoItems.innerHTML += `<li>${item.nombre} - ${item.precio} €</li>`;
                    });
                    document.getElementById('precioTotal').innerText = carrito.precioTotal;
                })
                .catch(error => console.error("Error al agregar al carrito:", error));
        }




        function realizarPedido() {
            alert("Pedido confirmado! Procediendo al pago...");
        }
    </script>
</body>

</html>